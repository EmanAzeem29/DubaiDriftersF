<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dubai Drifters - Booking</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    body { 
      font-family: 'Poppins', sans-serif; 
      background-color: #FDF6EC;
    }
    
    .header-gradient {
      background: linear-gradient(to right, #000000, #1a1a1a, #0d0d0d);
    }
    
    .progress-bar {
      height: 6px;
      background-color: #e5e7eb;
      border-radius: 3px;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      background-color: #C89B52;
      transition: width 0.5s ease;
    }
    
    .mobile-menu {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }
    
    .mobile-menu.open {
      max-height: 500px;
    }
    
    .confirmation-check {
      animation: checkmark 0.5s ease-in-out;
    }
    
    @keyframes checkmark {
      0% { transform: scale(0); opacity: 0; }
      50% { transform: scale(1.2); opacity: 0.7; }
      100% { transform: scale(1); opacity: 1; }
    }
    
    .loading-spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #C89B52;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
      display: inline-block;
      margin-right: 8px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .error-message {
      color: #e53e3e;
      font-size: 0.875rem;
      margin-top: 0.25rem;
    }
  </style>
</head>
<body class="bg-gray-50">
  <!-- Header -->
  <header class="header-gradient text-white shadow-lg sticky top-0 z-50">
    <div class="container mx-auto px-4">
      <div class="flex justify-between items-center py-2">
        <!-- Logo + Name -->
        <a href="index.html" class="flex items-center space-x-4">
          <img src="logo.jpg" alt="Logo" 
               class="h-16 w-16 rounded-full object-cover border-4 border-[#C89B52] shadow-lg hover:scale-110 transition-transform duration-300"
               onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiByeD0iMzIiIGZpbGw9IiNDODlCNTIiLz4KPHN2Zz4K'"/>
          <span class="text-2xl font-bold tracking-wide text-[#C89B52]">Dubai Drifters</span>
        </a>
        
        <!-- Desktop Menu -->
        <div class="hidden md:flex items-center space-x-6 text-sm text-white font-medium">
          <a class="hover:text-[#C89B52] transition-colors duration-300 hover:scale-105" href="about.html">About Us</a>
          <a class="hover:text-[#C89B52] transition-colors duration-300 hover:scale-105" href="contact.html">Contact Us</a>
          <a class="hover:text-[#C89B52] transition-colors duration-300 hover:scale-105" href="blog.html">Blog</a>

          <a class="flex items-center hover:text-[#C89B52] transition duration-300 hover:scale-105" href="#">
            <span class="material-icons text-lg mr-1">person</span>
            <span>Sign In</span>
          </a>
        </div>
        
        <!-- Mobile Menu Button -->
        <div class="md:hidden">
          <button id="mobileMenuBtn" class="text-white hover:text-[#C89B52] transition duration-300">
            <span class="material-icons">menu</span>
          </button>
        </div>
      </div>

      <hr class="opacity-20 border-[#C89B52]"/>

      <!-- Desktop Nav Links -->
      <nav class="hidden md:flex justify-center items-center py-3 space-x-8 text-sm font-semibold text-white">
        <a href="index.html" class="hover:text-[#C89B52] transition duration-300 hover:scale-105">Home</a>
        <a href="tours.html" class="hover:text-[#C89B52] transition duration-300 hover:scale-105">Tours</a>
        <a href="visa.html" class="hover:text-[#C89B52] transition duration-300 hover:scale-105">Visa</a>
        <a href="about.html" class="hover:text-[#C89B52] transition duration-300 hover:scale-105">About Us</a>
        <a href="blog.html" class="hover:text-[#C89B52] transition duration-300 hover:scale-105">Blog</a>
        <a href="contact.html" class="hover:text-[#C89B52] transition duration-300 hover:scale-105">Contact</a>
      </nav>
      
      <!-- Mobile Menu -->
      <div id="mobileMenu" class="mobile-menu md:hidden bg-[#1a1a1a] rounded-b-lg shadow-lg">
        <div class="py-4 px-4 space-y-4">
          <a class="block text-white hover:text-[#C89B52] transition duration-300" href="index.html">Home</a>
          <a class="block text-white hover:text-[#C89B52] transition duration-300" href="tours.html">Tours</a>
          <a class="block text-white hover:text-[#C89B52] transition duration-300" href="visa.html">Visa</a>
          <a class="block text-white hover:text-[#C89B52] transition duration-300" href="about.html">About Us</a>
          <a class="block text-white hover:text-[#C89B52] transition duration-300" href="blog.html">Blog</a>
          <a class="block text-white hover:text-[#C89B52] transition duration-300" href="contact.html">Contact</a>
        </div>
      </div>
    </div>
  </header>

  <!-- Booking Section -->
  <section class="py-12 container mx-auto px-4">
    <div class="max-w-4xl mx-auto">
      <!-- Progress Bar -->
      <div class="mb-8">
        <div class="flex justify-between mb-2">
          <span class="text-sm font-medium text-gray-500">Cart</span>
          <span class="text-sm font-medium text-[#C89B52]">Booking Details</span>
          <span class="text-sm font-medium text-gray-500">Confirmation</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" style="width: 66%"></div>
        </div>
      </div>

      <div class="flex justify-between items-center mb-8">
        <h1 class="text-3xl font-bold text-gray-800">Complete Your Booking</h1>
        <div class="flex items-center text-gray-600">
          <span class="material-icons mr-2">event</span>
          <span id="orderId">Order #DD-000000</span>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Booking Form -->
        <div class="lg:col-span-2">
          <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Personal Information</h3>
            <form id="bookingForm">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">First Name *</label>
                  <input type="text" name="firstName" required class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#C89B52]">
                  <div class="error-message" id="firstNameError"></div>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Last Name *</label>
                  <input type="text" name="lastName" required class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#C89B52]">
                  <div class="error-message" id="lastNameError"></div>
                </div>
              </div>
              
              <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">Email Address *</label>
                <input type="email" name="email" required class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#C89B52]">
                <div class="error-message" id="emailError"></div>
              </div>
              
              <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">Phone Number *</label>
                <input type="tel" name="phone" required class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#C89B52]">
                <div class="error-message" id="phoneError"></div>
              </div>
              
              <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">Country *</label>
                <input type="text" name="country" required class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#C89B52]">
                <div class="error-message" id="countryError"></div>
              </div>
              
              <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">Special Requirements</label>
                <textarea name="specialRequirements" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#C89B52]" rows="3" placeholder="Any special requirements or notes..."></textarea>
              </div>
            </form>
          </div>

          <!-- Payment Section -->
          <div class="bg-white rounded-lg shadow-lg p-6">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Payment Details</h3>
            
            <div id="easyPaisaSection">
              <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-4">
                <div class="flex">
                  <div class="flex-shrink-0">
                    <span class="material-icons text-blue-400">info</span>
                  </div>
                  <div class="ml-3">
                    <p class="text-sm text-blue-700">
                      <span class="font-medium">EasyPaisa Payment Instructions</span>
                    </p>
                  </div>
                </div>
              </div>
              
              <div class="bg-gray-50 p-4 rounded-lg mb-4">
                <h4 class="font-semibold text-gray-800 mb-2">Send Payment To:</h4>
                <div class="space-y-2 text-sm">
                  <p><span class="font-medium">Account Number:</span> 01234567890</p>
                  <p><span class="font-medium">Account Name:</span> M Abdullah</p>
                  <p><span class="font-medium">Amount:</span> <span id="paymentAmount" class="text-[#C89B52] font-bold">$0.00</span></p>
                </div>
              </div>
              
              <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Upload Payment Screenshot *</label>
                <input type="file" id="paymentScreenshot" name="paymentScreenshot" accept="image/*" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#C89B52]">
                <div class="error-message" id="screenshotError"></div>
                <p class="text-xs text-gray-500 mt-1">Please upload a clear screenshot of your EasyPaisa payment confirmation</p>
              </div>
              
              <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4">
                <div class="flex">
                  <div class="flex-shrink-0">
                    <span class="material-icons text-yellow-400">warning</span>
                  </div>
                  <div class="ml-3">
                    <p class="text-sm text-yellow-700">
                      <span class="font-medium">Important:</span> Your booking will be confirmed only after we verify your payment. Our team will contact you within 24 hours.
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Order Summary -->
        <div class="lg:col-span-1">
          <div class="bg-white rounded-lg shadow-lg p-6 sticky top-24">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Order Summary</h3>
            
            <div id="bookingItems" class="space-y-3 mb-4">
              <!-- Booking items will be populated here -->
            </div>
            
            <div class="space-y-2 border-t pt-4">
              <div class="flex justify-between">
                <span class="text-gray-600">Subtotal</span>
                <span id="bookingSubtotal">$0.00</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">Taxes & Fees</span>
                <span id="bookingTaxes">$0.00</span>
              </div>
              <div class="flex justify-between font-bold text-lg border-t pt-2">
                <span>Total</span>
                <span id="bookingTotal" class="text-[#C89B52]">$0.00</span>
              </div>
            </div>
            
            <button id="confirmBookingBtn" class="w-full bg-[#C89B52] hover:bg-[#b38642] text-white font-semibold py-3 rounded-lg shadow-lg transition flex items-center justify-center mt-6">
              <span class="material-icons mr-2">check_circle</span>
              <span id="confirmBtnText">Confirm Booking</span>
              <div id="loadingSpinner" class="loading-spinner hidden"></div>
            </button>
            
            <p class="text-xs text-gray-500 text-center mt-4">By confirming, you agree to our <a href="#" class="text-[#C89B52] hover:underline">Terms of Service</a></p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="bg-gray-800 text-white">
    <div class="container mx-auto px-4 py-10">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
        <div>
          <h4 class="font-bold text-lg mb-4">About Dubaidrifters.com</h4>
          <p class="text-sm text-gray-400">Your trusted partner for exploring the wonders of Dubai. We provide a wide range of tours, activities, and travel services to make your trip memorable.</p>
        </div>
        <div>
          <h4 class="font-bold text-lg mb-4">Support</h4>
          <ul class="space-y-2 text-sm">
            <li><a class="text-gray-400 hover:text-white" href="contact.html">Contact Us</a></li>
            <li><a class="text-gray-400 hover:text-white" href="#">FAQs</a></li>
            <li><a class="text-gray-400 hover:text-white" href="termsandconditions.html">Terms & Conditions</a></li>
            <li><a class="text-gray-400 hover:text-white" href="#">Privacy Policy</a></li>
          </ul>
        </div>
        <div>
          <h4 class="font-bold text-lg mb-4">Follow Us</h4>
          <div class="flex space-x-2">
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
            <!-- Facebook -->
            <a class="text-gray-400 hover:text-white" href="https://www.facebook.com/YourPageName" target="_blank">
              <i class="fab fa-facebook"></i>
            </a>

            <!-- WhatsApp -->
            <a class="text-gray-400 hover:text-white" href="https://wa.me/923001234567" target="_blank">
              <i class="fab fa-whatsapp"></i>
            </a>

            <!-- Instagram -->
            <a class="text-gray-400 hover:text-white" href="https://www.instagram.com/YourUsername" target="_blank">
              <i class="fab fa-instagram"></i>
            </a>
          </div>
          <h4 class="font-bold text-lg mt-6 mb-4">Payment Methods</h4>
          <div class="flex space-x-2">
            <a href="https://www.easypaisa.com.pk" 
               target="_blank" 
               rel="noopener noreferrer"
               class="text-xs bg-gray-700 px-2 py-1 rounded hover:bg-gray-600 transition">
               EasyPaisa
            </a>
          </div>
        </div>
        <div>
          <h4 class="font-bold text-lg mb-4">Newsletter</h4>
          <p class="text-sm text-gray-400 mb-4">Subscribe to our newsletter for exclusive offers and updates.</p>
          <form id="newsletterForm" class="flex">
            <input id="newsletterEmail" class="w-full rounded-l-md p-2 text-gray-800 focus:outline-none" placeholder="Your email" type="email" required/>
            <button id="newsletterBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 rounded-r-md transition-colors flex items-center" type="submit">
              <span id="newsletterBtnText">Subscribe</span>
            </button>
          </form>
        </div>
      </div>
      <div class="border-t border-gray-700 mt-8 pt-6 text-center text-sm text-gray-500">
        <p>© 2025 Dubaidrifters.com. All Rights Reserved.</p>
      </div>
    </div>
  </footer>

  <script>
    // API Configuration - Update these with your actual backend endpoints
    const API_CONFIG = {
     const API_BASE ="https://api.dubaidrifters.com/api";


 ENDPOINTS: {
        CREATE_BOOKING: '/bookings',
        UPLOAD_FILE: '/upload',
        GET_BOOKING: '/bookings'
      }
    };

    document.addEventListener("DOMContentLoaded", function() {
      // Mobile menu toggle
      const mobileMenuBtn = document.getElementById("mobileMenuBtn");
      const mobileMenu = document.getElementById("mobileMenu");
      
      if(mobileMenuBtn && mobileMenu) {
        mobileMenuBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          mobileMenu.classList.toggle("open");
          // Change icon based on state
          const icon = mobileMenuBtn.querySelector(".material-icons");
          if(mobileMenu.classList.contains("open")) {
            icon.textContent = "close";
          } else {
            icon.textContent = "menu";
          }
        });
        
        // Close mobile menu when clicking outside
        document.addEventListener("click", (e) => {
          if(!mobileMenu.contains(e.target) && !mobileMenuBtn.contains(e.target)) {
            mobileMenu.classList.remove("open");
            mobileMenuBtn.querySelector(".material-icons").textContent = "menu";
          }
        });
      }

      // Load booking data
      const bookingData = JSON.parse(localStorage.getItem("bookingData"));
      
      if (!bookingData || !bookingData.cart || bookingData.cart.length === 0) {
        // Redirect to tours if no booking data
        window.location.href = "tours.html";
        return;
      }

      // Display order ID
      document.getElementById("orderId").textContent = `Order #${bookingData.orderId}`;

      // Display booking items and calculate totals
      const bookingItemsContainer = document.getElementById("bookingItems");
      const bookingSubtotal = document.getElementById("bookingSubtotal");
      const bookingTaxes = document.getElementById("bookingTaxes");
      const bookingTotal = document.getElementById("bookingTotal");
      const paymentAmount = document.getElementById("paymentAmount");

      let subtotal = 0;
      
      bookingData.cart.forEach(item => {
        subtotal += item.price * item.quantity;
        
        const itemElement = document.createElement("div");
        itemElement.className = "flex justify-between text-sm";
        itemElement.innerHTML = `
          <div>
            <p class="font-medium">${item.name}</p>
            <p class="text-gray-500">${item.quantity} x $${item.price}</p>
          </div>
          <span class="font-medium">$${(item.price * item.quantity).toFixed(2)}</span>
        `;
        bookingItemsContainer.appendChild(itemElement);
      });

      const taxes = subtotal * 0.05;
      const total = subtotal + taxes;

      bookingSubtotal.textContent = `$${subtotal.toFixed(2)}`;
      bookingTaxes.textContent = `$${taxes.toFixed(2)}`;
      bookingTotal.textContent = `$${total.toFixed(2)}`;
      paymentAmount.textContent = `$${total.toFixed(2)}`;

      // Form validation
      function validateForm() {
        let isValid = true;
        const form = document.getElementById('bookingForm');
        const inputs = form.querySelectorAll('input[required]');
        
        // Clear previous errors
        document.querySelectorAll('.error-message').forEach(el => {
          el.textContent = '';
        });
        
        // Validate required fields
        inputs.forEach(input => {
          if (!input.value.trim()) {
            const errorId = input.name + 'Error';
            document.getElementById(errorId).textContent = 'This field is required';
            isValid = false;
          }
        });
        
        // Validate email format
        const emailInput = form.querySelector('input[type="email"]');
        if (emailInput.value && !isValidEmail(emailInput.value)) {
          document.getElementById('emailError').textContent = 'Please enter a valid email address';
          isValid = false;
        }
        
        // Validate phone format
        const phoneInput = form.querySelector('input[type="tel"]');
        if (phoneInput.value && !isValidPhone(phoneInput.value)) {
          document.getElementById('phoneError').textContent = 'Please enter a valid phone number';
          isValid = false;
        }
        
        // Validate screenshot
        const screenshot = document.getElementById('paymentScreenshot').files[0];
        if (!screenshot) {
          document.getElementById('screenshotError').textContent = 'Payment screenshot is required';
          isValid = false;
        }
        
        return isValid;
      }
      
      function isValidEmail(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
      }
      
      function isValidPhone(phone) {
        // Basic phone validation - adjust as needed
        const phoneRegex = /^[\+]?[0-9\s\-\(\)]{10,}$/;
        return phoneRegex.test(phone);
      }
      
      // API functions
      async function uploadFile(file) {
        const formData = new FormData();
        formData.append('file', file);
        
        try {
          const response = await fetch(`${API_CONFIG.BASE_URL}${API_CONFIG.ENDPOINTS.UPLOAD_FILE}`, {
            method: 'POST',
            body: formData
          });
          
          if (!response.ok) {
            throw new Error('File upload failed');
          }
          
          const data = await response.json();
          return data.fileUrl; // Assuming the API returns the file URL
        } catch (error) {
          console.error('Error uploading file:', error);
          throw error;
        }
      }
      
      async function createBooking(bookingData) {
        try {
          const response = await fetch(`${API_CONFIG.BASE_URL}${API_CONFIG.ENDPOINTS.CREATE_BOOKING}`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(bookingData)
          });
          
          if (!response.ok) {
            throw new Error('Booking creation failed');
          }
          
          const data = await response.json();
          return data;
        } catch (error) {
          console.error('Error creating booking:', error);
          throw error;
        }
      }
      
      // Confirm booking functionality
      document.getElementById("confirmBookingBtn").addEventListener("click", async function() {
        const form = document.getElementById("bookingForm");
        const screenshot = document.getElementById("paymentScreenshot").files[0];
        
        // Validate form
        if (!validateForm()) {
          return;
        }
        
        // Show loading state
        const confirmBtn = document.getElementById("confirmBookingBtn");
        const confirmBtnText = document.getElementById("confirmBtnText");
        const loadingSpinner = document.getElementById("loadingSpinner");
        
        confirmBtn.disabled = true;
        confirmBtnText.textContent = "Processing...";
        loadingSpinner.classList.remove("hidden");
        
        try {
          // Upload payment screenshot
          const screenshotUrl = await uploadFile(screenshot);
          
          // Prepare booking data for API
          const formData = new FormData(form);
          const personalInfo = {
            firstName: formData.get('firstName'),
            lastName: formData.get('lastName'),
            email: formData.get('email'),
            phone: formData.get('phone'),
            country: formData.get('country'),
            specialRequirements: formData.get('specialRequirements')
          };
          
          const apiBookingData = {
            orderId: bookingData.orderId,
            personalInfo: personalInfo,
            cart: bookingData.cart,
            subtotal: subtotal,
            taxes: taxes,
            total: total,
            paymentMethod: 'easypaisa',
            paymentScreenshot: screenshotUrl,
            status: 'pending'
          };
          
          // Send booking to backend
          const bookingResponse = await createBooking(apiBookingData);
          
          // Store final booking data locally
          const finalBookingData = {
            ...apiBookingData,
            bookingId: bookingResponse.bookingId, // Assuming API returns a booking ID
            bookingConfirmed: true,
            createdAt: new Date().toISOString()
          };
          
          localStorage.setItem("finalBookingData", JSON.stringify(finalBookingData));
          
          // Clear cart
          localStorage.removeItem("cart");
          
          // Redirect to confirmation page
          window.location.href = "booking-confirmation.html";
          
        } catch (error) {
          // Show error message
          alert("There was an error processing your booking. Please try again.");
          console.error("Booking error:", error);
          
          // Reset button state
          confirmBtn.disabled = false;
          confirmBtnText.textContent = "Confirm Booking";
          loadingSpinner.classList.add("hidden");
        }
      });
    });
  </script>
</body>

</html>


